#!/bin/sh

# Output debug information
echo "pre-commit hook starts executing"

# Switch to the repository root directory
cd "$(git rev-parse --show-toplevel)"
echo "Switched to repository root: $(pwd)"

# Run TSC
echo "Running TypeScript compilation..."
cmd.exe /c "$(git rev-parse --show-toplevel)/hooks/prepare_commit.bat"
echo "TypeScript compilation completed"

# Check if TSC was successful
if [ $? -ne 0 ]; then
    echo "TypeScript compilation failed, commit aborted"
    exit 1
fi

# Add generated files to the Git staging area
echo "Adding generated files to Git staging area..."
git add .
echo "Files added to staging area"

echo "pre-commit hook execution completed"